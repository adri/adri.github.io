<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9b87e697c172e14543a6.css">.tippy-box[data-animation=shift-away][data-state=hidden]{opacity:0}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=top]{transform:translateY(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=bottom]{transform:translateY(-10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=left]{transform:translateX(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=right]{transform:translateX(-10px)}</style><meta name="generator" content="Gatsby 2.24.2"/><link as="script" rel="preload" href="/webpack-runtime-744a352b16d5b84aca0e.js"/><link as="script" rel="preload" href="/framework-c5c887c038a86482cf43.js"/><link as="script" rel="preload" href="/app-2c7ba478ae5217fad203.js"/><link as="script" rel="preload" href="/styles-53aa9d4f42ead6242a9b.js"/><link as="script" rel="preload" href="/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js"/><link as="fetch" rel="preload" href="/page-data/MySQL Optimizer Trace to debug slow queries/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="gndras">body{--theme-ui-colors-text:var(--theme-ui-colors-text,rgb(74,85,104));--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000000);--theme-ui-colors-text-light:var(--theme-ui-colors-text-light,#718096);--theme-ui-colors-navigation:var(--theme-ui-colors-navigation,black);--theme-ui-colors-links:var(--theme-ui-colors-links,#3182ce);--theme-ui-colors-background:var(--theme-ui-colors-background,#ffffff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#3333ee);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#111199);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#f6f6f6);--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,#efeffe);--theme-ui-colors-gray:var(--theme-ui-colors-gray,#777777);--theme-ui-colors-accent:var(--theme-ui-colors-accent,#660099);--theme-ui-colors-darken:var(--theme-ui-colors-darken,rgba(0,0,0,.25));color:var(--theme-ui-colors-text,rgb(74,85,104));background-color:var(--theme-ui-colors-background,#ffffff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,rgb(217,215,224));--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#ffffff);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,rgb(14,14,14));--theme-ui-colors-navigation:var(--theme-ui-colors-modes-dark-navigation,white);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#33ccff);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#ee00ff);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#191919);--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#29112c);--theme-ui-colors-gray:var(--theme-ui-colors-modes-dark-gray,#999999);--theme-ui-colors-accent:var(--theme-ui-colors-modes-dark-accent,#cc00ff);}</style><style data-emotion-css="6unzqy">*{box-sizing:border-box;}body{margin:0;font-family:"Inter var",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5;font-weight:400;padding:10px;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1ilvuat">.css-1ilvuat{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;max-width:1036px;margin:0 auto;}</style><style data-emotion-css="15rtii6">.css-15rtii6{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;max-width:1036px;margin:0 auto;}</style><div class="css-15rtii6"><header><style data-emotion-css="ze196x">.css-ze196x{border-bottom:1px solid;border-color:#777777;}</style><style data-emotion-css="1utn7q5">.css-1utn7q5{box-sizing:border-box;margin:0;min-width:0;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;border-bottom:1px solid;border-color:#777777;}</style><div class="css-1utn7q5"><style data-emotion-css="51lrgf">.css-51lrgf{font-weight:700;color:rgb(74,85,104);-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-51lrgf" href="/">Notes</a><style data-emotion-css="16efl3x">.css-16efl3x{padding:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:transparent;border-radius:5px;border:0;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:-11px;opacity:0.75;overflow:hidden;position:relative;-webkit-transform:scale(0.75);-ms-transform:scale(0.75);transform:scale(0.75);-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;vertical-align:middle;width:40px;}.css-16efl3x:hover{opacity:1;}</style><button aria-label="Activate dark mode" title="Activate dark mode" class="css-16efl3x"><style data-emotion-css="k6f7ly">.css-k6f7ly{border:2px solid black;background:black;border-radius:50%;height:24px;overflow:hidden;position:relative;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all 0.45s ease;transition:all 0.45s ease;width:24px;}.css-k6f7ly::before{border-radius:50%;border:2px solid black;content:"";height:24px;opacity:1;position:absolute;right:-9px;top:-9px;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);-webkit-transition:-webkit-transform 0.45s ease;-webkit-transition:transform 0.45s ease;transition:transform 0.45s ease;width:24px;}.css-k6f7ly::after{border-radius:50%;box-shadow:0 -23px 0 black, 0 23px 0 black, 23px 0 0 black, -23px 0 0 black, 15px 15px 0 black, -15px 15px 0 black, 15px -15px 0 black, -15px -15px 0 black;content:"";height:8px;left:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;width:8px;-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transition:all 0.35s ease;transition:all 0.35s ease;}</style><div class="css-k6f7ly"></div><style data-emotion-css="1tlbtl8">.css-1tlbtl8{background:white;border-radius:50%;border:0;height:24px;opacity:1;position:absolute;right:0;top:0;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);-webkit-transition:background 0.25s ease,-webkit-transform 0.45s ease;-webkit-transition:background 0.25s ease,transform 0.45s ease;transition:background 0.25s ease,transform 0.45s ease;width:24px;}</style><div class="css-1tlbtl8"></div></button></div></header><style data-emotion-css="1qbm0jn">.css-1qbm0jn{-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><style data-emotion-css="1ob75md">.css-1ob75md{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-1ob75md"><style data-emotion-css="15y92lb">.css-15y92lb{-webkit-flex:1;-ms-flex:1;flex:1;width:100%;}</style><div class="css-15y92lb"><style data-emotion-css="1ebprri">.css-1ebprri{margin-top:16px;margin-bottom:16px;}</style><style data-emotion-css="43flnf">.css-43flnf{font-family:inherit;line-height:1.125;font-weight:700;font-size:32px;margin-top:16px;margin-bottom:16px;}</style><h1 class="css-43flnf">MySQL Optimizer Trace to debug slow queries</h1><p class="css-0">An optimizer trace can show why a query executes slowly in MySQL to optimize <style data-emotion-css="18ci6ln">.css-18ci6ln{color:#3182ce;-webkit-text-decoration:none;text-decoration:none;}.css-18ci6ln:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><style data-emotion-css="wqwu9j">.css-wqwu9j{color:#3182ce;padding-left:2px;padding-right:2px;margin-left:-2px;margin-right:-2px;border-radius:4px;color:#3182ce;-webkit-text-decoration:none;text-decoration:none;}.css-wqwu9j:hover{background-color:#660099;}.css-wqwu9j:focus{background-color:#660099;}.css-wqwu9j:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-wqwu9j" href="/Performance">Performance</a>. The trace contains costs of different indexes that are evaluated and reasons why one is chosen over the other.</p><style data-emotion-css="or0o2o">.css-or0o2o{font-family:inherit;line-height:1.125;font-weight:700;font-size:20px;font-family:inherit;line-height:1.125;font-weight:700;font-size:20px;}</style><h3 class="css-or0o2o">Get a trace</h3><p class="css-0">Traces are per session. Enabling <code class="css-0">optimizer_trace</code> it doesn&#x27;t affect other sessions.</p><style data-emotion-css="not1ib">.css-not1ib{color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;}.css-not1ib .prolog{color:rgb(0,0,128);}.css-not1ib .comment{color:rgb(106,153,85);}.css-not1ib .builtin,.css-not1ib .changed,.css-not1ib .keyword{color:rgb(86,156,214);}.css-not1ib .number,.css-not1ib .inserted{color:rgb(181,206,168);}.css-not1ib .constant{color:rgb(100,102,149);}.css-not1ib .attr-name,.css-not1ib .variable{color:rgb(156,220,254);}.css-not1ib .deleted,.css-not1ib .string,.css-not1ib .attr-value{color:rgb(206,145,120);}.css-not1ib .selector{color:rgb(215,186,125);}.css-not1ib .tag{color:rgb(86,156,214);}.css-not1ib .punctuation,.css-not1ib .operator{color:rgb(212,212,212);}.css-not1ib .punctuation{color:#808080;}.css-not1ib .function{color:rgb(220,220,170);}.css-not1ib .class-name{color:rgb(78,201,176);}.css-not1ib .char{color:rgb(209,105,105);}.css-not1ib .prolog{color:rgb(0,0,128);}.css-not1ib .comment{color:rgb(106,153,85);}.css-not1ib .builtin,.css-not1ib .changed,.css-not1ib .keyword{color:rgb(86,156,214);}.css-not1ib .number,.css-not1ib .inserted{color:rgb(181,206,168);}.css-not1ib .constant{color:rgb(100,102,149);}.css-not1ib .attr-name,.css-not1ib .variable{color:rgb(156,220,254);}.css-not1ib .deleted,.css-not1ib .string,.css-not1ib .attr-value{color:rgb(206,145,120);}.css-not1ib .selector{color:rgb(215,186,125);}.css-not1ib .tag{color:rgb(86,156,214);}.css-not1ib .punctuation,.css-not1ib .operator{color:rgb(212,212,212);}.css-not1ib .punctuation{color:#808080;}.css-not1ib .function{color:rgb(220,220,170);}.css-not1ib .class-name{color:rgb(78,201,176);}.css-not1ib .char{color:rgb(209,105,105);}</style><style data-emotion-css="1gfzwqh">.css-1gfzwqh{color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;}</style><style data-emotion-css="1rwhrlg">.css-1rwhrlg{color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;}.css-1rwhrlg .prolog{color:rgb(0,0,128);}.css-1rwhrlg .comment{color:rgb(106,153,85);}.css-1rwhrlg .builtin,.css-1rwhrlg .changed,.css-1rwhrlg .keyword{color:rgb(86,156,214);}.css-1rwhrlg .number,.css-1rwhrlg .inserted{color:rgb(181,206,168);}.css-1rwhrlg .constant{color:rgb(100,102,149);}.css-1rwhrlg .attr-name,.css-1rwhrlg .variable{color:rgb(156,220,254);}.css-1rwhrlg .deleted,.css-1rwhrlg .string,.css-1rwhrlg .attr-value{color:rgb(206,145,120);}.css-1rwhrlg .selector{color:rgb(215,186,125);}.css-1rwhrlg .tag{color:rgb(86,156,214);}.css-1rwhrlg .punctuation,.css-1rwhrlg .operator{color:rgb(212,212,212);}.css-1rwhrlg .punctuation{color:#808080;}.css-1rwhrlg .function{color:rgb(220,220,170);}.css-1rwhrlg .class-name{color:rgb(78,201,176);}.css-1rwhrlg .char{color:rgb(209,105,105);}</style><pre class="language-sql prism-code language-sql css-1rwhrlg"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token comment css-1baulvz"># Turn tracing on (it&#x27;s off by default):</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">SET</span><span class="token plain css-1baulvz"> optimizer_trace</span><span class="token operator css-1baulvz">=</span><span class="token string css-1baulvz">&quot;enabled=on&quot;</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token comment css-1baulvz"># Run query</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">SELECT</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">.</span><span class="token punctuation css-1baulvz">.</span><span class="token punctuation css-1baulvz">.</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token comment css-1baulvz"># See the trace of the query</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">SELECT</span><span class="token plain css-1baulvz"> </span><span class="token operator css-1baulvz">*</span><span class="token plain css-1baulvz"> </span><span class="token keyword css-1baulvz">FROM</span><span class="token plain css-1baulvz"> INFORMATION_SCHEMA</span><span class="token punctuation css-1baulvz">.</span><span class="token plain css-1baulvz">OPTIMIZER_TRACE</span><span class="token punctuation css-1baulvz">;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token comment css-1baulvz"># When done with tracing, disable it:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">SET</span><span class="token plain css-1baulvz"> optimizer_trace</span><span class="token operator css-1baulvz">=</span><span class="token string css-1baulvz">&quot;enabled=off&quot;</span><span class="token punctuation css-1baulvz">;</span></div></pre><h3 class="css-or0o2o">Read a trace</h3><p class="css-0">Optimizer traces are JSON encoded. Best to copy the structure in a JSON viewer. The trace contains these steps:</p><ul class="css-0"><li class="css-0"><code class="css-0">join_preparation</code> shows early query rewrites</li><li class="css-0"><code class="css-0">join_optimization</code> shows how execution plan is built - <code class="css-0">condition_processing</code> basic rewrites in WHERE/ON conditions - <code class="css-0">ref_optimizer_key_uses</code>: Construction of possible ways to do ref and eq_ref accesses - <code class="css-0">rows_estimation</code>: Estimations of index costs, <code class="css-0">usable</code> and <code class="css-0">cause</code> can give hints why an index is not used - <code class="css-0">considered_execution_plans</code>: Choice of the join order - <code class="css-0">attaching_conditions_to_tables</code> Once the join order is fixed, parts of the WHERE clause are &quot;attached&quot; to tables to filter out rows as early as possible</li><li class="css-0"><code class="css-0">join_execution</code> shows any optimizations during execution. The optimizer can overwrite an execution plan with heuristics e.g. <code class="css-0">reconsidering_access_paths_for_index_ordering</code>.</li></ul><h3 class="css-or0o2o">Sources</h3><ul class="css-0"><li class="css-0"><a class="css-18ci6ln" href="https://dev.mysql.com/doc/internals/en/optimizer-tracing-typical-usage.html">https://dev.mysql.com/doc/internals/en/optimizer-tracing-typical-usage.html</a></li><li class="css-0"><a class="css-18ci6ln" href="https://mariadb.com/kb/en/optimizer-trace-guide/">https://mariadb.com/kb/en/optimizer-trace-guide/</a></li></ul></div></div><style data-emotion-css="rl6otz">.css-rl6otz{border-radius:8px;}</style><style data-emotion-css="smnvxu">.css-smnvxu{box-sizing:border-box;margin:0;min-width:0;margin-bottom:8px;color:#718096;border-radius:8px;}</style><div class="css-smnvxu"></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/MySQL Optimizer Trace to debug slow queries";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-171ef24e414fdbc216e8.js"],"app":["/app-2c7ba478ae5217fad203.js"],"component---src-templates-note-js":["/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js"]};/*]]>*/</script><script src="/polyfill-171ef24e414fdbc216e8.js" nomodule=""></script><script src="/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js" async=""></script><script src="/styles-53aa9d4f42ead6242a9b.js" async=""></script><script src="/app-2c7ba478ae5217fad203.js" async=""></script><script src="/framework-c5c887c038a86482cf43.js" async=""></script><script src="/webpack-runtime-744a352b16d5b84aca0e.js" async=""></script></body></html>