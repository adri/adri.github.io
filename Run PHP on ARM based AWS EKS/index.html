<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9b87e697c172e14543a6.css">.tippy-box[data-animation=shift-away][data-state=hidden]{opacity:0}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=top]{transform:translateY(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=bottom]{transform:translateY(-10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=left]{transform:translateX(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=right]{transform:translateX(-10px)}</style><meta name="generator" content="Gatsby 2.24.2"/><link as="script" rel="preload" href="/webpack-runtime-744a352b16d5b84aca0e.js"/><link as="script" rel="preload" href="/framework-c5c887c038a86482cf43.js"/><link as="script" rel="preload" href="/app-2c7ba478ae5217fad203.js"/><link as="script" rel="preload" href="/styles-53aa9d4f42ead6242a9b.js"/><link as="script" rel="preload" href="/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js"/><link as="fetch" rel="preload" href="/page-data/Run PHP on ARM based AWS EKS/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="gndras">body{--theme-ui-colors-text:var(--theme-ui-colors-text,rgb(74,85,104));--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000000);--theme-ui-colors-text-light:var(--theme-ui-colors-text-light,#718096);--theme-ui-colors-navigation:var(--theme-ui-colors-navigation,black);--theme-ui-colors-links:var(--theme-ui-colors-links,#3182ce);--theme-ui-colors-background:var(--theme-ui-colors-background,#ffffff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#3333ee);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#111199);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#f6f6f6);--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,#efeffe);--theme-ui-colors-gray:var(--theme-ui-colors-gray,#777777);--theme-ui-colors-accent:var(--theme-ui-colors-accent,#660099);--theme-ui-colors-darken:var(--theme-ui-colors-darken,rgba(0,0,0,.25));color:var(--theme-ui-colors-text,rgb(74,85,104));background-color:var(--theme-ui-colors-background,#ffffff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,rgb(217,215,224));--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#ffffff);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,rgb(14,14,14));--theme-ui-colors-navigation:var(--theme-ui-colors-modes-dark-navigation,white);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#33ccff);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#ee00ff);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#191919);--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#29112c);--theme-ui-colors-gray:var(--theme-ui-colors-modes-dark-gray,#999999);--theme-ui-colors-accent:var(--theme-ui-colors-modes-dark-accent,#cc00ff);}</style><style data-emotion-css="6unzqy">*{box-sizing:border-box;}body{margin:0;font-family:"Inter var",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5;font-weight:400;padding:10px;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1ilvuat">.css-1ilvuat{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;max-width:1036px;margin:0 auto;}</style><style data-emotion-css="15rtii6">.css-15rtii6{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;max-width:1036px;margin:0 auto;}</style><div class="css-15rtii6"><header><style data-emotion-css="ze196x">.css-ze196x{border-bottom:1px solid;border-color:#777777;}</style><style data-emotion-css="1utn7q5">.css-1utn7q5{box-sizing:border-box;margin:0;min-width:0;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;border-bottom:1px solid;border-color:#777777;}</style><div class="css-1utn7q5"><style data-emotion-css="51lrgf">.css-51lrgf{font-weight:700;color:rgb(74,85,104);-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-51lrgf" href="/">Notes</a><style data-emotion-css="16efl3x">.css-16efl3x{padding:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:transparent;border-radius:5px;border:0;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:-11px;opacity:0.75;overflow:hidden;position:relative;-webkit-transform:scale(0.75);-ms-transform:scale(0.75);transform:scale(0.75);-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;vertical-align:middle;width:40px;}.css-16efl3x:hover{opacity:1;}</style><button aria-label="Activate dark mode" title="Activate dark mode" class="css-16efl3x"><style data-emotion-css="k6f7ly">.css-k6f7ly{border:2px solid black;background:black;border-radius:50%;height:24px;overflow:hidden;position:relative;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all 0.45s ease;transition:all 0.45s ease;width:24px;}.css-k6f7ly::before{border-radius:50%;border:2px solid black;content:"";height:24px;opacity:1;position:absolute;right:-9px;top:-9px;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);-webkit-transition:-webkit-transform 0.45s ease;-webkit-transition:transform 0.45s ease;transition:transform 0.45s ease;width:24px;}.css-k6f7ly::after{border-radius:50%;box-shadow:0 -23px 0 black, 0 23px 0 black, 23px 0 0 black, -23px 0 0 black, 15px 15px 0 black, -15px 15px 0 black, 15px -15px 0 black, -15px -15px 0 black;content:"";height:8px;left:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;width:8px;-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transition:all 0.35s ease;transition:all 0.35s ease;}</style><div class="css-k6f7ly"></div><style data-emotion-css="1tlbtl8">.css-1tlbtl8{background:white;border-radius:50%;border:0;height:24px;opacity:1;position:absolute;right:0;top:0;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);-webkit-transition:background 0.25s ease,-webkit-transform 0.45s ease;-webkit-transition:background 0.25s ease,transform 0.45s ease;transition:background 0.25s ease,transform 0.45s ease;width:24px;}</style><div class="css-1tlbtl8"></div></button></div></header><style data-emotion-css="1qbm0jn">.css-1qbm0jn{-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><style data-emotion-css="1ob75md">.css-1ob75md{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-1ob75md"><style data-emotion-css="15y92lb">.css-15y92lb{-webkit-flex:1;-ms-flex:1;flex:1;width:100%;}</style><div class="css-15y92lb"><style data-emotion-css="1ebprri">.css-1ebprri{margin-top:16px;margin-bottom:16px;}</style><style data-emotion-css="43flnf">.css-43flnf{font-family:inherit;line-height:1.125;font-weight:700;font-size:32px;margin-top:16px;margin-bottom:16px;}</style><h1 class="css-43flnf">Run PHP on ARM based AWS EKS</h1><p class="css-0">Amazon has publishedd a blog post <style data-emotion-css="18ci6ln">.css-18ci6ln{color:#3182ce;-webkit-text-decoration:none;text-decoration:none;}.css-18ci6ln:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-18ci6ln" href="https://aws.amazon.com/blogs/compute/improving-performance-of-php-for-arm64-and-impact-on-amazon-ec2-m6g-instances/">Improving performance of PHP for Arm64 and impact on AWS Graviton2 based EC2 instances</a> that shows 20% cheaper ARM based instances with better performance.</p><style data-emotion-css="or0o2o">.css-or0o2o{font-family:inherit;line-height:1.125;font-weight:700;font-size:20px;font-family:inherit;line-height:1.125;font-weight:700;font-size:20px;}</style><h3 class="css-or0o2o">ARM</h3><ul class="css-0"><li class="css-0">ARM is a company that develops and sells the ARM processor architecture. </li><li class="css-0">ARM uses <strong class="css-0">RISC</strong> (reduced instruction set computing)</li><li class="css-0">Intel and AMD use <strong class="css-0">CISC</strong> (complex instruction set computing)</li></ul><h3 class="css-or0o2o">RISC vs CISC example</h3><p class="css-0">A comparison of the pros and cons between the two approaches:</p><style data-emotion-css="753nho">.css-753nho{width:100%;border-collapse:separate;border-spacing:0;width:100%;border-collapse:separate;border-spacing:0;}</style><table class="css-753nho"><thead><tr class="css-0"><style data-emotion-css="1av8mni">.css-1av8mni{text-align:left;border-bottom-style:solid;text-align:left;border-bottom-style:solid;}</style><th class="css-1av8mni">RISC</th><th class="css-1av8mni">CISC</th></tr></thead><tbody><tr class="css-0"><td class="css-1av8mni">Focus on software</td><td class="css-1av8mni">Focus on hardware</td></tr><tr class="css-0"><td class="css-1av8mni">Simple instructions (single-clock)</td><td class="css-1av8mni">Complex  instructions (multi-clock)</td></tr><tr class="css-0"><td class="css-1av8mni">Large assembly code size</td><td class="css-1av8mni">Small assembly code size</td></tr><tr class="css-0"><td class="css-1av8mni">Lower power usage</td><td class="css-1av8mni">Higher power usage</td></tr><tr class="css-0"><td class="css-1av8mni">Slower compile times</td><td class="css-1av8mni">Faster compile times</td></tr></tbody></table><p class="css-0">Many years ago the RAM price was very high, so CISC had advantages because it uses less instructions. The price of RAM has decreased and compilers have become smarter making RISC the better architecture now.</p><h3 class="css-or0o2o">RISC vs CISC example</h3><p class="css-0">Some background on CPU architecture to understand the trade-offs between the two.</p><p class="css-0">Example:</p><p class="css-0"><code class="css-0">a = a * b</code></p><p class="css-0">RISC uses only basic commands, leading to many instructions:</p><style data-emotion-css="not1ib">.css-not1ib{color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;}.css-not1ib .prolog{color:rgb(0,0,128);}.css-not1ib .comment{color:rgb(106,153,85);}.css-not1ib .builtin,.css-not1ib .changed,.css-not1ib .keyword{color:rgb(86,156,214);}.css-not1ib .number,.css-not1ib .inserted{color:rgb(181,206,168);}.css-not1ib .constant{color:rgb(100,102,149);}.css-not1ib .attr-name,.css-not1ib .variable{color:rgb(156,220,254);}.css-not1ib .deleted,.css-not1ib .string,.css-not1ib .attr-value{color:rgb(206,145,120);}.css-not1ib .selector{color:rgb(215,186,125);}.css-not1ib .tag{color:rgb(86,156,214);}.css-not1ib .punctuation,.css-not1ib .operator{color:rgb(212,212,212);}.css-not1ib .punctuation{color:#808080;}.css-not1ib .function{color:rgb(220,220,170);}.css-not1ib .class-name{color:rgb(78,201,176);}.css-not1ib .char{color:rgb(209,105,105);}.css-not1ib .prolog{color:rgb(0,0,128);}.css-not1ib .comment{color:rgb(106,153,85);}.css-not1ib .builtin,.css-not1ib .changed,.css-not1ib .keyword{color:rgb(86,156,214);}.css-not1ib .number,.css-not1ib .inserted{color:rgb(181,206,168);}.css-not1ib .constant{color:rgb(100,102,149);}.css-not1ib .attr-name,.css-not1ib .variable{color:rgb(156,220,254);}.css-not1ib .deleted,.css-not1ib .string,.css-not1ib .attr-value{color:rgb(206,145,120);}.css-not1ib .selector{color:rgb(215,186,125);}.css-not1ib .tag{color:rgb(86,156,214);}.css-not1ib .punctuation,.css-not1ib .operator{color:rgb(212,212,212);}.css-not1ib .punctuation{color:#808080;}.css-not1ib .function{color:rgb(220,220,170);}.css-not1ib .class-name{color:rgb(78,201,176);}.css-not1ib .char{color:rgb(209,105,105);}</style><style data-emotion-css="1gfzwqh">.css-1gfzwqh{color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;}</style><style data-emotion-css="1rwhrlg">.css-1rwhrlg{color:#9CDCFE;background-color:#1E1E1E;font-family:Monaco,monospace;width:100%;border-radius:8px;overflow-x:scroll;padding:16px;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;color:#f6f6f6;font-family:Monaco,monospace;font-size:inherit;}.css-1rwhrlg .prolog{color:rgb(0,0,128);}.css-1rwhrlg .comment{color:rgb(106,153,85);}.css-1rwhrlg .builtin,.css-1rwhrlg .changed,.css-1rwhrlg .keyword{color:rgb(86,156,214);}.css-1rwhrlg .number,.css-1rwhrlg .inserted{color:rgb(181,206,168);}.css-1rwhrlg .constant{color:rgb(100,102,149);}.css-1rwhrlg .attr-name,.css-1rwhrlg .variable{color:rgb(156,220,254);}.css-1rwhrlg .deleted,.css-1rwhrlg .string,.css-1rwhrlg .attr-value{color:rgb(206,145,120);}.css-1rwhrlg .selector{color:rgb(215,186,125);}.css-1rwhrlg .tag{color:rgb(86,156,214);}.css-1rwhrlg .punctuation,.css-1rwhrlg .operator{color:rgb(212,212,212);}.css-1rwhrlg .punctuation{color:#808080;}.css-1rwhrlg .function{color:rgb(220,220,170);}.css-1rwhrlg .class-name{color:rgb(78,201,176);}.css-1rwhrlg .char{color:rgb(209,105,105);}</style><pre class="language-asm6502 prism-code language-asm6502 css-1rwhrlg"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token plain css-1baulvz">LOAD A, 2:3  ; `2:3` is the where the value `a` is stored</span></div><div class="token-line"><span class="token plain css-1baulvz">LOAD B, 5:2  ; `5:2` is the where the value `b` is stored</span></div><div class="token-line"><span class="token plain css-1baulvz">PROD A, B    ; multiply </span></div><div class="token-line"><span class="token plain css-1baulvz">STORE 2:3, A ; store back in `a`</span></div></pre><p class="css-0">CISC uses complex commands that are implemented in hardware:</p><pre class="language-asm6502 prism-code language-asm6502 css-1rwhrlg"><div class="token-line"><span class="token plain css-1baulvz">MULT 2:3, 5:2 ; all in one instruction</span></div></pre><h3 class="css-or0o2o">Why isn&#x27;t RISC the standard?</h3><ul class="css-0"><li class="css-0">Missing software support (Windows was designed for CISC)</li><li class="css-0">Little commercial interest meant less chips produced and higher prices for ARM based chips</li><li class="css-0">Intel did a lot of work to make CISC good</li></ul><h3 class="css-or0o2o">Cloud providers</h3><p class="css-0">On AWS a <code class="css-0">m6g.4xlarge</code> costs 20% less than a <code class="css-0">m5.4xlarge</code> and is up to 40% faster. </p><h3 class="css-or0o2o">Steps to run PHP on ARM on AWS EKS</h3><ul class="css-0"><li class="css-0">Server needs to run on ARM in AWS EKS</li><li class="css-0">Kubernetes tools needs to run on ARM in AWS EKS</li><li class="css-0">Software needs to compile to ARM </li><li class="css-0">Container needs to be built to ARM on CI</li></ul><h3 class="css-or0o2o">Findings</h3><ul class="css-0"><li class="css-0">New Relic doesn&#x27;t have ARM builds:<br/><a class="css-18ci6ln" href="https://discuss.newrelic.com/t/feature-request-arm-architecture-support/23244/11">Vote for the feature here</a></li><li class="css-0">CircleCI doesn&#x27;t have ARM support. But images can be built via <code class="css-0">docker buildx</code>. That&#x27;s slow because it&#x27;s emulated but at least it works</li><li class="css-0">Most things seem to be available on ARM!</li></ul><h3 class="css-or0o2o">Use AWS EKS AMI with ARM</h3><p class="css-0">A AWS EKS AMI image can be retrieved using this command:</p><pre class="prism-code language-css-1gfzwqh css-1rwhrlg"><div class="token-line"><span class="token plain css-1baulvz">aws ssm get-parameter --name /aws/service/eks/optimized-ami/1.16/amazon-linux-2-arm64/recommended/image_id --region eu-west-1 --query &quot;Parameter.Value&quot; --output text</span></div></pre><p class="css-0">A node group with that image needs to be added. Using the option
<code class="css-0">--register-with-taints=dedicated=arm64:NoSchedule</code> is recommended so no pods are scheduled on these nodes. </p><p class="css-0">When running node groups with x86 and arm64 containers at the same time, the Kubernetes tools like kube-proxy and Amazon VPC CNI Plugin need to be deployed on the arm64 nodes. The <a class="css-18ci6ln" href="https://docs.aws.amazon.com/eks/latest/userguide/arm-support.html#enable-arm-support">AWS guide to enable ARM support</a> has all YAML definitions. The names and labels need to be changed to not conflict with the existing x86 versions. This step might be skipped in the future when the images can support multiple architectures. </p><p class="css-0">Pods can be given a toleration and affinity to be scheduled on an ARM node:</p><pre class="language-yaml prism-code language-yaml css-1rwhrlg"><div class="token-line"><span class="token key atrule css-1baulvz">tolerations</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> </span><span class="token key atrule css-1baulvz">effect</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> NoSchedule</span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token key atrule css-1baulvz">key</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> dedicated</span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token key atrule css-1baulvz">operator</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> Equal</span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token key atrule css-1baulvz">value</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> arm64</span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token key atrule css-1baulvz">affinity</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token key atrule css-1baulvz">nodeAffinity</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token key atrule css-1baulvz">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">        </span><span class="token key atrule css-1baulvz">nodeSelectorTerms</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">         </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> </span><span class="token key atrule css-1baulvz">matchExpressions</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">           </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> </span><span class="token key atrule css-1baulvz">key</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;kubernetes.io/os&quot;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">operator</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> In</span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">values</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">              </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> linux</span></div><div class="token-line"><span class="token plain css-1baulvz">           </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> </span><span class="token key atrule css-1baulvz">key</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;kubernetes.io/arch&quot;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">operator</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> In</span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">values</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">              </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> arm64</span></div><div class="token-line"><span class="token plain css-1baulvz">           </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> </span><span class="token key atrule css-1baulvz">key</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;eks.amazonaws.com/compute-type&quot;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">operator</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> NotIn</span></div><div class="token-line"><span class="token plain css-1baulvz">             </span><span class="token key atrule css-1baulvz">values</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">               </span><span class="token punctuation css-1baulvz">-</span><span class="token plain css-1baulvz"> fargate</span></div></pre><h3 class="css-or0o2o">Build docker container</h3><p class="css-0">To build a container that supports multiple architectures:</p><ol class="css-0"><li class="css-0"><p class="css-0">Use docker edge version</p></li><li class="css-0"><p class="css-0">Create a new builder</p><pre class="language-bash prism-code language-bash css-1rwhrlg"><div class="token-line"><span class="token plain css-1baulvz">docker buildx create --name mybuilder</span></div></pre></li><li class="css-0"><p class="css-0">Use the new builder
Build images for x86 and arm64 architectures:</p><p class="css-0">Base image:</p><pre class="prism-code language-css-1gfzwqh css-1rwhrlg"><div class="token-line"><span class="token plain css-1baulvz">docker buildx build --platform linux/amd64,linux/arm64 -t adri/test:base-arm -f etc/php7-fpm/Dockerfile.base --push .</span></div></pre><p class="css-0">Main image:</p><pre class="prism-code language-css-1gfzwqh css-1rwhrlg"><div class="token-line"><span class="token plain css-1baulvz">docker buildx build --platform linux/amd64,linux/arm64 -t adri/test:arm-test -f etc/php7-fpm/Dockerfile --push .</span></div></pre></li></ol><h3 class="css-or0o2o">Sources</h3><ul class="css-0"><li class="css-0"><a class="css-18ci6ln" href="https://www.docker.com/blog/multi-arch-images/">Building Multi-Arch Images for Arm and x86 with Docker Desktop</a></li><li class="css-0"><a class="css-18ci6ln" href="https://aws.amazon.com/blogs/compute/improving-performance-of-php-for-arm64-and-impact-on-amazon-ec2-m6g-instances/">Improving performance of PHP for Arm64 and impact on AWS Graviton2 based EC2 instances</a></li><li class="css-0"><a class="css-18ci6ln" href="https://www.androidcentral.com/what-arm-cpu">What is ARM</a></li><li class="css-0"><a class="css-18ci6ln" href="https://cs.stanford.edu/people/eroberts/courses/soco/projects/2000-01/risc/risccisc/">RISC vs CISC</a></li></ul></div></div><style data-emotion-css="rl6otz">.css-rl6otz{border-radius:8px;}</style><style data-emotion-css="smnvxu">.css-smnvxu{box-sizing:border-box;margin:0;min-width:0;margin-bottom:8px;color:#718096;border-radius:8px;}</style><div class="css-smnvxu"></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/Run PHP on ARM based AWS EKS";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-171ef24e414fdbc216e8.js"],"app":["/app-2c7ba478ae5217fad203.js"],"component---src-templates-note-js":["/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js"]};/*]]>*/</script><script src="/polyfill-171ef24e414fdbc216e8.js" nomodule=""></script><script src="/component---src-templates-note-js-9fa0cebec8bfafbf59ce.js" async=""></script><script src="/styles-53aa9d4f42ead6242a9b.js" async=""></script><script src="/app-2c7ba478ae5217fad203.js" async=""></script><script src="/framework-c5c887c038a86482cf43.js" async=""></script><script src="/webpack-runtime-744a352b16d5b84aca0e.js" async=""></script></body></html>