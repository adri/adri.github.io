---
layout: post
title: "Wie der Index von Apache HBase funktioniert"
summary: "Für sehr viele Daten sind vorhandene Index-Strukturen wie B+-Bäume nicht immer optimal. Apache HBase, eine Opensource-Implementierung von Googele Bigtable, verwendet LSM-Bäume zum schnellen Zugriff auf viele Daten. Wie funktionieren LSM-Bäume und warum sind sie so geeignet für \"Big Data\"?"
published: false
---

Zum Speichern großer Datenmengen ("Big Data") werden immer häufiger nicht relationale Datenbanken verwendet – wie zum Beispiel HBase [Quelle]. Ein Grund dafür ist eine andere Indexstruktur die die Eigenschaften von Festplatten gekonnt ausnutzt. Googles Bigtable und das davon inspirierten HBase verwenden LSM-Bäume (Log Structured Merge) statt der in relationalen Datenbanken üblichen B+-Bäume. 

Um die Vorteile eines LSM-Baums zu verstehen, ist es zunächst nötig ein paar Kennzahlen einer Festplatte sowie die Funktionsweise von B+-Bäumen verstanden zu haben. Ich setzte vorraus, dass ein Grundverständnis für Indizes (und warum diese für Datenbanken so wichtig sind) und für die Funktionsweise von Festplatten vorhanden ist.

## Kennzahlen von Festplatten

### Mittlere Zugriffszeit

Das ist die Zeit, die eine Festplatte durchschnittlich braucht, bis der Schreib-/Lesekopf an einer gewünschten Position auf der Festplatte ist. Im Mittel kann man davon ausgehen, dass die [Zugriffszeit](http://de.wikipedia.org/wiki/Zugriffszeit) bei einer guten Festplatte in einem RAID-Verbund` bei 2-3 Millisekunden liegt, siehe Tabelle.
<table>
<caption>Zugriffszeiten nach Festplattenart, Stand&nbsp;Januar&nbsp;2012, Quelle [Wikipedia](http://en.wikipedia.org/wiki/Seek_time#cite_note-WD-Scorpio_Blue-specs-12)</caption>
<tr><th>Art der Festplatte</th><th>ø Zugriffszeit [ms](http://de.wikipedia.org/wiki/Millisekunde</th></tr>
<tr><td>Desktop</td><td>9 ms</td></tr>
<tr><td>Highend</td><td>3 ms</td></tr>
<tr><td>SSD</td><td>0,08 - 0,16 ms</td></tr>
</table>

Laut dem Buch [HBase]() kann pro Jahr die mittlere Zugriffszeit um 5% verbessert werden – also nichts im Vergleich zur Datenübertragungsrate.

### Datenübertragungsrate

Menge der Daten die pro Zeiteinheit am Stück von der Festplatte gelesen werden kann – oft ist die Einheit ´Megabyte pro Sekunde´. "Am Stück" lesen bedeutet, dass die Daten sequentiell auf der Festplatte liegen und so Block für Block gelesen werden. Unterschieden werden zwei Datenübertragungsraten: Lesend und schreibend.

Optische Festplatten (siehe SATA-Festplatten in der Tabelle) sind im `RAID-Verbund` verglichen mit SSDs immernoch sehr schnell und gleichzeitig günstiger.
<table>
<caption>Datenübertragungsrate nach Festplattenart, Stand&nbsp;Januar&nbsp;2012, Quelle [tom's hardware](http://www.tomshardware.com)</caption>
<tr><th>Art der Festplatte</th>
<th>ø Datenübertragungsrate lesend</th></tr>
<tr><td>Desktop 7200 RPM</td><td>120 MByte/s</td></tr>
<tr><td>Highend 15000 RPM</td><td>170 MByte/s</td></tr>
<tr><td>SSD SATA 3GB/s</td><td>300 MByte/s</td></tr>
</table>

Während sich die mittleren Zugriffszeit über die letzten Jahre kaum verbessert hat, entwickelt sich die Datenübertragungsrate deutlich besser. Pro Jahr sind Steigerungen von bis zu ?% zu erwarten. Erreicht wird die höhere Übertragungsrate durch eine höhere Dichte der Informationseinheiten auf der Festplatte. 
Die höhere Dichte der Daten führt auch zu mehr Speicherkapazität insgesamt. Folgendes Diagramm zeigt die Entwicklung der Speicherkapazität auf einer log-Skala.
![](http://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Hard_drive_capacity_over_time.svg/500px-Hard_drive_capacity_over_time.svg.png)

Um also in Zukunft bei sehr vielen Daten eine gute Index-Geschwindigkeit bei gleichzeitig niedrigen Kosten zu gewährleisten, will man von der Zugriffszeit unabhängig sein. Der ein oder andere Leser ahnt es sicherlich – **der Index sollte möglichst an die Datenübertragungsrate gebunden sein** und nicht an die Zugriffszeit.

## B+-Baum

Funktionsweise
Vor- und Nachteile
+ O(log(n))
+ Schnelle Bereichsabfragen
+ Schnelles Suchen von sortierten Daten
- umstrukturierung
- Gebunden an Zugriffszeit
 Unterschieden werden zwei Datenübertragungsraten: Lesend und schreibend.
Ziel ist möglichst schnell einen Eintrag auf der Festplatte zu finden.

### Die Tiefe eines Baums ist für die Geschwindigkeit ausschlaggebend 
Die maximale Tiefe eines balancierten Baums berechnet sich durch log(n). Ein Eintrag auf der Festplatte wird also schneller gefunden, wenn die Tiefe möglichst gering ist. Wenn der Baum weniger tief sein soll, müssen die Knoten im Baum in di und gleichzeitig günstiger.Breite gehen. 


### Berreichsabfragen sind schnell 

### Sortierte Einträge sind schnell

### Geschwindigkeit ist an die Zugriffszeit gebunden

Im Gegensatz zur mittleren Zugriffszeit entwickelt sich die Datenübertragungsrate deutlich besser. Pro Jahr sind Steigerungen von bis zu ?% zu erwarten. 

## LSM wie folgendes Diagramm zeigt-Ba.
----------- 

Funktionsweise
Vor- und Nachteile
+ sequentiell
+ Gebunden an Datenübertragungsrate

