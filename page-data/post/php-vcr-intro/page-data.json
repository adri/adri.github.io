{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/post/php-vcr-intro","result":{"data":{"post":{"__typename":"MdxPost","slug":"/post/php-vcr-intro","title":"Mocking HTTP interactions automatically using PHP-VCR","date":"2013-03-07","tags":null,"description":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"layout\": \"post\",\n  \"title\": \"Mocking HTTP interactions automatically using PHP-VCR\",\n  \"slug\": \"/post/php-vcr-intro\",\n  \"summary\": \"If you want to test PHP code which calls REST-, SOAP- or other APIs you normally mock all API calls. Maintaining those mocks manually can be quite some work, especially when APIs change often.\",\n  \"date\": \"2013-03-07T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"If you want to test PHP code which calls REST-, SOAP- or other APIs you normally mock all API calls. Maintaining those mocks manually can be quite some work, especially when APIs change often.\"), mdx(\"div\", {\n    \"style\": {\n      \"maxWidth\": \"300px\"\n    }\n  }, mdx(\"span\", _extends({\n    parentName: \"div\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/df3da2a527b50480456cd69949349476/5ece7/php-vcr-logo.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"20%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/svg+xml,%3csvg%20xmlns=\\\\'http://www.w3.org/2000/svg\\\\'%20width=\\\\'400\\\\'%20height=\\\\'80\\\\'%20viewBox=\\\\'0%200%20400%2080\\\\'%20preserveAspectRatio=\\\\'none\\\\'%3e%3cpath%20d=\\\\'M197%2028c-7%203-10%2012-6%2018%209%2013%2028%200%2020-13-3-5-8-7-14-5\\\\'%20fill=\\\\'%23d3d3d3\\\\'%20fill-rule=\\\\'evenodd\\\\'/%3e%3c/svg%3e')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"picture\", {\n    parentName: \"a\"\n  }, \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/df3da2a527b50480456cd69949349476/cbea2/php-vcr-logo.webp 240w\", \"/static/df3da2a527b50480456cd69949349476/42669/php-vcr-logo.webp 480w\", \"/static/df3da2a527b50480456cd69949349476/10c02/php-vcr-logo.webp 960w\", \"/static/df3da2a527b50480456cd69949349476/5bb53/php-vcr-logo.webp 1200w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"type\": \"image/webp\"\n  })), \"\\n        \", mdx(\"source\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"srcSet\": [\"/static/df3da2a527b50480456cd69949349476/5243c/php-vcr-logo.png 240w\", \"/static/df3da2a527b50480456cd69949349476/ab158/php-vcr-logo.png 480w\", \"/static/df3da2a527b50480456cd69949349476/7d769/php-vcr-logo.png 960w\", \"/static/df3da2a527b50480456cd69949349476/5ece7/php-vcr-logo.png 1200w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"type\": \"image/png\"\n  })), \"\\n        \", mdx(\"img\", _extends({\n    parentName: \"picture\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"src\": \"/static/df3da2a527b50480456cd69949349476/7d769/php-vcr-logo.png\",\n    \"alt\": \"PHP-VCR logo\",\n    \"title\": \"PHP-VCR logo\",\n    \"loading\": \"lazy\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    }\n  })), \"\\n      \"), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"To make your live easier I'd like to introduce \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://github.com/adri/php-vcr\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }), \"PHP-VCR\"), \". It is a port of the fabulous \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://github.com/vcr/vcr\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }), \"VCR lib for ruby\"), \" which records your test suite's HTTP interactions and replays them during future test runs.\"), mdx(\"h2\", null, \"What is VCR?\"), mdx(\"p\", null, \"VCR is a library that is able to record HTTP network traffic over the wire and then replay those requests locally. Since recording occurs only once, all subsequent executions of your tests do not need to hit the network, and will likely be much faster.\"), mdx(\"h2\", null, \"Installing PHP-VCR\"), mdx(\"p\", null, \"There is no release yet but you can install PHP-VCR by adding the following line to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"composer.json\"), \" file. PHP-VCR is almost always used exclusivly while testing you should add it to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"require-dev\"), \" section and install them using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"composer install --dev\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"    \\\"require-dev\\\": {\\n        \\\"php-vcr/phpvcr\\\": \\\"dev-master\\\"\\n    }\\n\")), mdx(\"h2\", null, \"Using PHP-VCR\"), mdx(\"p\", null, \"Whenever your test suite issues an HTTP(s) request, it is intercepted by PHP-VCR. If a request hasn't been recorded it will be executed and it's response stored in a file (called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cassette\"), \").\"), mdx(\"p\", null, \"Lets see some example code. Enable PHP-VCR in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bootstrap.php\"), \" right after including your class loader.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-php\"\n  }), \"require_once __DIR__ . \\\"/../vendor/autoload.php\\\";\\n\\n\\\\VCR\\\\VCR::turnOn();\\n\")), mdx(\"p\", null, \"From now on every HTTP request is intercepted. If you use no cassette, an exception is thrown so you know if there are any unwanted requests.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-php\"\n  }), \"public function testSomeMethod()\\n{\\n    \\\\VCR\\\\VCR::insertCassette('example');\\n    // Now all requests will be recorded and replayed during future test runs\\n\\n    file_get_contents('http://example.org');\\n    \\\\VCR\\\\VCR::eject();\\n}\\n\")), mdx(\"p\", null, \"Executing this example VCR will store a request to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://example.org\"), \" and it's response to the cassette file \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tests/fixtures/example\"), \" which looks something like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"- request:\\n    method: GET\\n    url: \\\"http://example.org/\\\"\\n    headers:\\n      Host: example.org\\n      User-Agent: \\\"Guzzle/3.0.7 curl/7.24.0 PHP/5.3.15\\\"\\n      Content-Length: 0\\n  response:\\n    status: 301\\n    headers:\\n      Location: \\\"http://www.example.org/\\\"\\n      Content-Type: \\\"text/html; charset=UTF-8\\\"\\n      Date: \\\"Wed, 27 Feb 2013 04:41:41 GMT\\\"\\n      Expires: \\\"Fri, 29 Mar 2013 04:41:41 GMT\\\"\\n    body: \\\"<HTML><BODY>\\u2026</BODY></HTML>\\\"\\n\")), mdx(\"p\", null, \"If you don't like YAML for your cassette files you can alternatively choose a JSON format or implement your own.\"), mdx(\"h2\", null, \"Conclusion\"), mdx(\"p\", null, \"VCR provides the same experience as when you mock HTTP interactions manually, but speeds up your development process. Whenever an external API format changes, just delete your cassette file and run your test suite again to record all HTTP interactions. VCR also helps you to identify requests which you've might not have been aware of. This way you can ensure every request is mocked.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"If you want to test PHP code which calls REST-, SOAP- or other APIs you normally mock all API calls. Maintaining those mocks manually can be…","timeToRead":1,"banner":null}},"pageContext":{"slug":"/post/php-vcr-intro","formatString":"YYYY-MM-DD"}},"staticQueryHashes":["318001574","3787687951"]}